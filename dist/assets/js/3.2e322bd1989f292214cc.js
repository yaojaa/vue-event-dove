webpackJsonp([3,6],{176:function(e,t,s){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i,n=s(28),r=a(n),l=s(3),d=a(l),o=s(2),c=s(207),v=a(c),u=s(27),m=a(u),f=s(4);t.default=(i={name:"sendDetail",verify:!0,data:function(){return{nohaveLabel:[],contentCannotHaveLabel:[],loading:!1,randered:!1,htmleditorOption:{fnReturnVal:"html",height:"500px",showWechat:!1,menus:null},sendVali:!0,copyDefault:{},sendersave:!0,arrReceiver:[],findTypeNames:{attendee:"所有参会人",paid:"所有购票者",timeOut:"超时未支付者",onsite:"线下未支付人员",pending:"未审核人员",reject:"审核拒绝人员"},findTypeValue:"",senderfields:{fromName:{rules:{required:!0,minLength:2,maxLength:20},value:""},from:{rules:{required:!0,isEmail:!0},value:"",nameInMessage:"发件人邮箱"}},option:{type:"min",format:"YYYY-MM-DD HH:mm:ss",language:"zhCn",inputStyle:{},color:{header:"#ccc",headerText:"#f00"},overlayOpacity:.5,dismissible:!0},limit:[{type:"fromto",from:(new Date).getTime()-864e5}]}},props:["sendDetails"],computed:{},created:function(){this.setData(),$(".edit-sender-layer.modal").remove()},mounted:function(){var e=this;"email"==this.sendDetails.category?$(".edit-sender-layer.modal").modal("attach events",".edit-sender").modal({onApprove:function(t){return e.sendersave}}):"",setTimeout(function(){e.randered=!0,e.$nextTick(function(){e.$refs.htmleditor.setContent(e.sendDetails.content)})},0)},components:{"html-editor":v.default,"date-picker":m.default}},(0,r.default)(i,"computed",{wordReminder:function(){if(!this.sendDetails.wordLength)return"";var e={"#活动链接#":21,"#姓名#":3,"#邮箱#":20,"#签到码#":6,"#电子票#":21},t=this.sendDetails.content;return $.each(e,function(e,s){var a=new RegExp(e,"g"),i=new Array(s+1).toString();t=t.replace(a,i)}),this.sendDetails.wordLength&&t.length>this.sendDetails.wordLength?"超过"+this.sendDetails.wordLength+"字，将按两条发送":void 0}}),(0,r.default)(i,"watch",{contentCannotHaveLabel:function(e){var t=this;$.each(e,function(e,s){var a="#"+s+"#";t.sendDetails.content=t.sendDetails.content.replace(new RegExp(a,"g"),"")}),this.$refs.htmleditor.setContent(this.sendDetails.content)}}),(0,r.default)(i,"methods",{setData:function(e){var t=this;e&&(this.sendDetails=e);var s="";if(""!=this.sendDetails.receivers&&("noticement"==this.sendDetails.type?(this.findTypeValue=this.sendDetails.receivers,"attendee"!=this.findTypeValue&&(this.nohaveLabel=["签到码","电子票"])):(this.arrReceiver=this.sendDetails.receivers.split(","),this.sendDetails.receivers.indexOf("|")&&(this.arrReceiver=this.sendDetails.receivers.split("|"),this.arrReceiver.forEach(function(e,s){e=e.replace(/\*/,"."),t.arrReceiver.splice(s,1,e)})))),s=this.arrReceiver.toString(),this.sendDetails.receivers=s,Object.prototype.toString.call(this.sendDetails.findType).indexOf("Array")>-1){var a={};$.each(this.sendDetails.findType,function(e,s){$.each(s,function(e,s){a[e]=t.findTypeNames[e]+"　　"+s})}),this.sendDetails.findType=a}},onResultChange:function(e,t){this.sendDetails.content=t},datevali:function(e){this.sendDetails.sendTime=e},selectchange:function(e){var t=this,s=$(e.target).find('[value="'+this.findTypeValue+'"]').text(),a=parseInt(s.split("　　")[1]),i=s.split("　　")[0];setTimeout(function(){t.sendVali=t.$verify.vali(e.target.getAttribute("filed"),a,{minSize:1}),t.sendVali&&"所有参会人"!=i?t.nohaveLabel=["签到码","电子票"]:t.nohaveLabel=[],t.contentCannotHaveLabel=t.nohaveLabel.concat(t.sendDetails.dynamicdata.promotion)},0)},senderSave:function(){var e=this,t=this.$verify.filter("senderfields");t.check().then(function(s){e.sendDetails=$.extend(!0,{},e.sendDetails,s),t.setValue().clear(),e.sendersave=!0},function(){e.sendersave=!1}).catch(function(e){})},addAddressee:function(e){var t=e.target,s=t.value,a="sms"==this.sendDetails.category?{isMobile:!0}:{isEmail:!0},i=this.$verify.vali(t.getAttribute("filed"),s,$.extend({isRepeat:this.arrReceiver},a));if(i){if(""!==this.sendDetails.receivers&&this.sendDetails.receivers.indexOf(",")==-1){var n=this.$verify.vali(null,this.sendDetails.receivers,a);n?"":this.sendDetails.receivers=""}this.sendDetails.receivers+=this.sendDetails.receivers.length>0?","+s:s,this.arrReceiver=this.sendDetails.receivers.split(","),t.value=""}},removeAddressee:function(e){this.arrReceiver.splice(e,1),this.sendDetails.receivers=this.arrReceiver.toString()},appendIn:function(e){this.$refs.htmleditor.append(e,"#"+$(e.target).text()+"#")},saveBefore:function(e){"noticement"==this.sendDetails.type&&(this.sendDetails.receivers=this.findTypeValue),this.sendDetails.isDraft=1==e,"imediately"==this.sendDetails.sendType&&(this.sendDetails.sendTime=null);var t=(0,f.dataFilter)(this.sendDetails);return t.content=$.trim(t.content).replace(/\s+#活动链接#/g,"#活动链接#"),t},clean:function(){this.sendDetails.receivers="",this.sendDetails.title="",this.sendDetails.content="",this.sendDetails.sendTime=null,this.sendDetails.id?delete this.sendDetails.id:"",this.sendDetails.isFromOrder?delete this.sendDetails.isFromOrder:"",this.arrReceiver=[],this.$refs.htmleditor?this.$refs.htmleditor.clear():""},save:function(e){var t=this;return this.loading=!0,this.sendVali?void this.$verify.filter("sendDetails").check().then(function(){var s=t.saveBefore(e),a=o.API_URL+"/notice/saveRecord";"string"==typeof t.sendDetails.id&&""!=t.sendDetails.id&&(s.recordId=t.sendDetails.id,a=o.API_URL+"/notice/updateRecord"),$.ajax({type:"POST",url:a,data:(0,d.default)(s),dataType:"json",contentType:"application/json",success:function(e){t.sendDetails.isDraft?t.$message.success("保存成功"):(t.$message.success("发送成功"),t.clean(),t.$emit("success")),t.$nextTick(function(){t.loading=!1})},error:function e(s){t.loading=!1;var e=JSON.parse(s.responseText);t.$message.error(e.responseText)}})},function(e){t.loading=!1}).catch(function(e){t.loading=!1}):(setTimeout(function(){t.$verify.$errors.findTypeValue="收件人个数不小于1"},0),!1)}}),i)},177:function(e,t,s){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=s(3),n=a(i),r=s(16),l=a(r),d=s(2),o=s(19),c=a(o),v=s(4);t.default={name:"viewlist",data:function(){return{viewlist:[],active:0,status:{sending:["正在发送","orange"],sendSuccess:["发送成功","green"],toBeSent:["等待发送","blue"],sendFail:["发送失败","red"]},pageData:{allPage:null,currentPage:1,showItem:5},viewlistData:{}}},computed:{categoryName:function(){return"email"==this.viewlistData.category?"邮件":"短信"}},props:["propsData"],created:function(){this.viewlistData=this.propsData,(1==this.viewlistData.isDraft&&"label3"==this.$route.params.label||0==this.viewlistData.isDraft&&"label2"==this.$route.params.label)&&this.setData()},mounted:function(){},components:{page:c.default},filters:{},methods:{setData:function(e){var t=this;"object"===("undefined"==typeof e?"undefined":(0,l.default)(e))&&(this.viewlistData=$.extend({},this.viewlistData,e)),$.ajax({type:"get",url:d.API_URL+"/notice/getRecords",data:this.viewlistData,dataType:"json",contentType:"application/json",success:function(e){(0,v.formatTime)(e,"YYYY-MM-DD HH:mm:ss"),t.viewlist=e.items,0!=e.items.length&&(t.active=0,t.pageData.allPage=parseInt((e.count-1)/t.viewlistData.limit)+1,t.pageData.currentPage=parseInt(t.viewlistData.page),setTimeout(function(){t.$refs.page.setpageData(t.pageData),$(".mail-details-layer.modal.isDraft").modal("attach events",".mail-details.isDraft"),$(".mail-details-layer.modal.notDraft").modal("attach events",".mail-details.notDraft")},0))},error:function(e){}})},deleteSend:function(e,t){var s=this;$(".confirm-layer.modal").modal({onApprove:function(a){return $.ajax({url:d.API_URL+"/notice/delRecord",type:"post",data:(0,n.default)({recordId:e}),dataType:"json",contentType:"application/json",success:function(e){t?s.$emit("success"):"",s.$message.success("删除成功"),1==s.viewlist.length?s.pageData.currentPage--:"",s.setData()},error:function e(t){var e=JSON.parse(t.responseText);s.$message.error(e.responseText)}}),!0}})},gotoPage:function(e){this.$router.push({name:this.viewlistData.category,params:{id:this.$route.params.id,page:e,label:this.$route.params.label}})}}}},199:function(e,t,s){t=e.exports=s(21)(),t.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",file:"index.vue",sourceRoot:"webpack://"}])},200:function(e,t,s){t=e.exports=s(21)(),t.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",file:"view_list.vue",sourceRoot:"webpack://"}])},201:function(e,t,s){var a=s(199);"string"==typeof a&&(a=[[e.id,a,""]]);s(22)(a,{});a.locals&&(e.exports=a.locals)},202:function(e,t,s){var a=s(200);"string"==typeof a&&(a=[[e.id,a,""]]);s(22)(a,{});a.locals&&(e.exports=a.locals)},208:function(e,t,s){var a,i;s(201),a=s(176);var n=s(210);i=a=a||{},"object"!=typeof a.default&&"function"!=typeof a.default||(i=a=a.default),"function"==typeof i&&(i=i.options),i.render=n.render,i.staticRenderFns=n.staticRenderFns,i._scopeId="data-v-36617b07",e.exports=a},209:function(e,t,s){var a,i;s(202),a=s(177);var n=s(211);i=a=a||{},"object"!=typeof a.default&&"function"!=typeof a.default||(i=a=a.default),"function"==typeof i&&(i=i.options),i.render=n.render,i.staticRenderFns=n.staticRenderFns,i._scopeId="data-v-d11472a6",e.exports=a},210:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",["email"==e.sendDetails.category?s("ui",{staticClass:"ui three column padded grid bg-gray"},[s("div",{staticClass:"column"},[s("span",{staticClass:"text-muted"},[e._v("发件人：")]),e._v(e._s(e.sendDetails.fromName))]),e._v(" "),s("div",{staticClass:"column"},[s("span",{staticClass:"text-muted"},[e._v("发件人邮箱：")]),e._v(e._s(e.sendDetails.from))]),e._v(" "),s("div",{staticClass:"column"},[s("a",{staticClass:"edit-sender",attrs:{href:"javascript:void(0)"},on:{click:function(e){}}},[e._v("编辑发件人")])])]):e._e(),e._v(" "),"email"==e.sendDetails.category?s("div",{staticClass:"ui divider hidden"}):e._e(),e._v(" "),s("div",{staticClass:"ui form"},[e.sendDetails.isFromOrder?e._e():s("div",{staticClass:"required field"},[s("label",{attrs:{for:""}},[e._v("发送形式")]),e._v(" "),s("div",{staticClass:"fields inline"},[s("div",{staticClass:"field"},[s("div",{directives:[{name:"ui",rawName:"v-ui"}],staticClass:"ui radio checkbox"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.sendDetails.type,expression:"sendDetails.type"}],attrs:{type:"radio",name:"item1",value:"promotion"},domProps:{checked:e._q(e.sendDetails.type,"promotion")},on:{change:function(t){e.contentCannotHaveLabel=e.sendDetails.dynamicdata.noticement},__c:function(t){e.sendDetails.type="promotion"}}}),e._v(" "),s("label",[e._v("活动推广")])])]),e._v(" "),s("div",{staticClass:"field"},[s("div",{directives:[{name:"ui",rawName:"v-ui"}],staticClass:"ui radio checkbox"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.sendDetails.type,expression:"sendDetails.type"}],attrs:{type:"radio",name:"item1",value:"noticement"},domProps:{checked:e._q(e.sendDetails.type,"noticement")},on:{change:function(t){e.contentCannotHaveLabel=e.sendDetails.dynamicdata.promotion},__c:function(t){e.sendDetails.type="noticement"}}}),e._v(" "),s("label",[e._v("活动通知")])])])])]),e._v(" "),s("div",{staticClass:"required field"},[s("label",{attrs:{for:""}},[e._v(e._s("email"==e.sendDetails.category?"邮件标题":"短信标题"))]),e._v(" "),s("input",{directives:[{name:"vali",rawName:"v-vali",value:JSON.stringify({required:!0}),expression:"JSON.stringify({required:true})"},{name:"model",rawName:"v-model",value:e.sendDetails.title,expression:"sendDetails.title"}],attrs:{type:"text",filed:"sendDetails.title",placeholder:"例：会唐商旅供应商大会"},domProps:{value:e.sendDetails.title},on:{input:function(t){t.target.composing||(e.sendDetails.title=t.target.value)}}}),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:""!=e.$verify.$errors["sendDetails.title"],expression:"$verify.$errors['sendDetails.title']!=''"}],staticClass:"ui pointing red basic label"},[e._v(e._s(e.$verify.$errors["sendDetails.title"])+" ")])]),e._v(" "),s("div",{staticClass:"required field"},[s("label",{attrs:{for:""}},[e._v("收件人")]),e._v(" "),"noticement"==e.sendDetails.type?s("div",[s("select",{directives:[{name:"model",rawName:"v-model",value:e.findTypeValue,expression:"findTypeValue"},{name:"vali",rawName:"v-vali",value:JSON.stringify({required:!0}),expression:"JSON.stringify({required:true})"}],staticClass:"ui dropdown fluid",attrs:{filed:"findTypeValue"},on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){var t="_value"in e?e._value:e.value;return t});e.findTypeValue=t.target.multiple?s:s[0]},e.selectchange]}},[s("option",{attrs:{value:""}},[e._v("请选择")]),e._v(" "),e._l(e.sendDetails.findType,function(t,a){return s("option",{domProps:{value:a}},[e._v(e._s(t))])})],2),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.$verify.$errors.findTypeValue&&""!=e.$verify.$errors.findTypeValue,expression:"$verify.$errors['findTypeValue']&&$verify.$errors['findTypeValue']!=''"}],staticClass:"ui pointing red basic label"},[e._v(e._s(e.$verify.$errors.findTypeValue)+" ")])]):e._e(),e._v(" "),"promotion"==e.sendDetails.type?s("div",[s("div",{staticClass:"mb-sm"},e._l(e.arrReceiver,function(t,a){return s("div",{staticClass:"ui label basic blue mini horizontal",on:{click:function(t){e.removeAddressee(a)}}},[e._v(e._s(t)+" "),s("i",{staticClass:"delete icon"})])})),e._v(" "),s("div",{staticClass:"ui input"},[s("input",{directives:[{name:"vali",rawName:"v-vali",value:JSON.stringify({required:!0}),expression:"JSON.stringify({required:true})"}],attrs:{type:"text",placeholder:"输入"+("sms"==e.sendDetails.category?"手机":"邮箱")+"号，并以“Enter“结束",filed:"sendDetails.receivers"},on:{keyup:function(t){return"button"in t||!e._k(t.keyCode,"enter",13)?void e.addAddressee(t):null}}})]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.$verify.$errors["sendDetails.receivers"]&&""!=e.$verify.$errors["sendDetails.receivers"],expression:"$verify.$errors['sendDetails.receivers']&&$verify.$errors['sendDetails.receivers']!=''"}],staticClass:"ui pointing red basic label"},[e._v(e._s(e.$verify.$errors["sendDetails.receivers"])+" ")])]):e._e()]),e._v(" "),s("div",{staticClass:"required field"},[s("label",{staticClass:"mt-n",attrs:{for:""}},[e._v(e._s("email"==e.sendDetails.category?"邮件":"短信")+"内容")]),e._v(" "),e.sendDetails.dynamicdata[e.sendDetails.type].length?s("div",{staticClass:"mb-xs"},e._l(e.sendDetails.dynamicdata[e.sendDetails.type],function(t){return e.nohaveLabel.indexOf(t)==-1?s("a",{staticClass:"ui tag label teal mr-sm",on:{click:e.appendIn}},[e._v(e._s(t))]):e._e()})):e._e(),e._v(" "),e.randered?s("html-editor",{directives:[{name:"vali",rawName:"v-vali",value:JSON.stringify({required:!0}),expression:"JSON.stringify({required:true})"}],ref:"htmleditor",attrs:{isNoMenu:"sms"==e.sendDetails.category,editorOption:"sms"==e.sendDetails.category?void 0:e.htmleditorOption,index:0,filed:"sendDetails.content",value:e.sendDetails.content,addEvent:"on-result-change##htmleditor"},on:{"on-result-change":e.onResultChange}}):e._e(),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.$verify.$errors["sendDetails.content"]&&""!=e.$verify.$errors["sendDetails.content"],expression:"$verify.$errors['sendDetails.content']&&$verify.$errors['sendDetails.content']!=''"}],staticClass:"ui pointing red basic label"},[e._v(e._s(e.$verify.$errors["sendDetails.content"])+" ")]),e._v(" "),e.wordReminder?s("p",{staticStyle:{color:"orange",border:"1px solid #efefef",padding:"5px","margin-top":"5px","border-radius":"5px"}},[e._v(e._s(e.wordReminder))]):e._e()],1),e._v(" "),s("div",{staticClass:"field"},[s("label",{staticClass:"mt-n",attrs:{for:""}},[e._v("发送时间")]),e._v(" "),s("div",{staticClass:"fields inline",staticStyle:{height:"40px"}},[s("div",{staticClass:"field"},[s("div",{directives:[{name:"ui",rawName:"v-ui"}],staticClass:"ui radio checkbox"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.sendDetails.sendType,expression:"sendDetails.sendType"}],attrs:{type:"radio",name:"tiem0",value:"imediately"},domProps:{checked:e._q(e.sendDetails.sendType,"imediately")},on:{__c:function(t){e.sendDetails.sendType="imediately"}}}),e._v(" "),s("label",[e._v("立即发送")])])]),e._v(" "),s("div",{staticClass:"field"},[s("div",{directives:[{name:"ui",rawName:"v-ui"}],staticClass:"ui radio checkbox"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.sendDetails.sendType,expression:"sendDetails.sendType"}],attrs:{type:"radio",name:"tiem0",value:"timed"},domProps:{checked:e._q(e.sendDetails.sendType,"timed")},on:{__c:function(t){e.sendDetails.sendType="timed"}}}),e._v(" "),s("label",[e._v("定时发送")])])]),e._v(" "),"timed"==e.sendDetails.sendType?s("div",{staticClass:"field"},[s("date-picker",{directives:[{name:"vali",rawName:"v-vali",value:JSON.stringify({required:!0}),expression:"JSON.stringify({required:true})"}],ref:"datepicker",attrs:{addEvent:"input##datepicker",date:e.sendDetails.sendTime,option:e.option,limit:e.limit,filed:"sendDetails.sendTime"},on:{input:function(t){e.datevali(arguments[0])}}}),e._v(" "),"timed"==e.sendDetails.sendType?s("div",{directives:[{name:"show",rawName:"v-show",value:e.$verify.$errors["sendDetails.sendTime"]&&""!=e.$verify.$errors["sendDetails.sendTime"],expression:"$verify.$errors['sendDetails.sendTime']&&$verify.$errors['sendDetails.sendTime']!=''"}],staticClass:"ui left pointing red basic label "},[e._v(e._s(e.$verify.$errors["sendDetails.sendTime"])+" ")]):e._e()],1):e._e()])]),e._v(" "),s("div",{staticClass:"text-center mt-lg"},[s("input",{staticClass:"ui button yellow",attrs:{type:"button",disabled:e.loading,value:"存为草稿"},on:{click:function(t){e.save(!0)}}}),e._v(" "),s("input",{staticClass:"ui button blue",attrs:{type:"button",disabled:e.loading,value:"发送"},on:{click:e.save}})])]),e._v(" "),s("div",{staticClass:"ui small modal edit-sender-layer"},[s("i",{staticClass:"close icon"}),e._v(" "),s("div",{staticClass:"header"},[e._v("\n            编辑发件人\n        ")]),e._v(" "),s("div",{staticClass:"content"},[s("div",{staticClass:"ui form"},[s("div",{staticClass:"required field"},[s("label",{attrs:{for:""}},[e._v("发件人：")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.senderfields.fromName.value,expression:"senderfields.fromName.value"},{name:"vali",rawName:"v-vali",value:e.senderfields.fromName.rules,expression:"senderfields.fromName.rules"}],attrs:{type:"text",name:"fromName",filed:"senderfields.fromName.value",placeholder:"会鸽"},domProps:{value:e.senderfields.fromName.value},on:{input:function(t){t.target.composing||(e.senderfields.fromName.value=t.target.value)}}}),e._v(" "),e.$verify.$errors["senderfields.fromName.value"]?s("div",{staticClass:"ui pointing red basic label"},[s("div",[e._v(" "+e._s(e.$verify.$errors["senderfields.fromName.value"])+" ")])]):e._e()]),e._v(" "),s("div",{staticClass:"required field"},[s("label",{attrs:{for:""}},[e._v("发件人邮箱：")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.senderfields.from.value,expression:"senderfields.from.value"},{name:"vali",rawName:"v-vali",value:e.senderfields.from.rules,expression:"senderfields.from.rules"}],attrs:{type:"email",name:"from",addEvent:"input",filed:"senderfields.from.value",placeholder:"support@eventdove.com"},domProps:{value:e.senderfields.from.value},on:{input:function(t){t.target.composing||(e.senderfields.from.value=t.target.value)}}}),e._v(" "),e.$verify.$errors["senderfields.from.value"]?s("div",{staticClass:"ui pointing red basic label"},[s("div",[e._v(" "+e._s(e.$verify.$errors["senderfields.from.value"])+" ")])]):e._e()])])]),e._v(" "),s("div",{staticClass:"actions text-center"},[s("button",{staticClass:"ui blue button ml-n ok",on:{click:e.senderSave}},[e._v("确定")]),e._v(" "),s("a",{staticClass:"ui button cancel"},[e._v("取消")])])])],1)},staticRenderFns:[]}},211:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.viewlist.length>0?s("table",{staticClass:"ui padded default table"},[s("thead",[e.viewlistData.isDraft?e._e():s("tr",[s("th",{domProps:{innerHTML:e._s(e.categoryName+"标题")}}),e._v(" "),s("th",[e._v("发送时间")]),e._v(" "),s("th",[e._v("发送状态")]),e._v(" "),s("th",[e._v("收信人数/已发送人数")]),e._v(" "),s("th",[e._v("操作")])]),e._v(" "),e.viewlistData.isDraft?s("tr",[s("th",{domProps:{innerHTML:e._s(e.categoryName+"标题")}}),e._v(" "),s("th",[e._v("收件人数")]),e._v(" "),s("th",[e._v("创建时间")]),e._v(" "),s("th",[e._v("操作")])]):e._e()]),e._v(" "),s("tbody",[e._l(e.viewlist,function(t,a){return e.viewlistData.isDraft?e._e():s("tr",[s("td",[s("a",{staticClass:"mail-details notDraft",attrs:{href:"javascript:void(0)"},on:{click:function(t){e.active=a}}},[e._v(e._s(t.title))])]),e._v(" "),s("td",[e._v(e._s(t.sendTime))]),e._v(" "),s("td",[s("div",{class:"ui horizontal label "+e.status[t.sendStatus][1]},[e._v(e._s(e.status[t.sendStatus][0]))])]),e._v(" "),s("td",[e._v(e._s(t.receiverTotal)+"/"+e._s(t.sendSuccessCount))]),e._v(" "),s("td",["toBeSent"==t.sendStatus?s("router-link",{staticClass:"mr-md",attrs:{to:{name:e.viewlistData.category,params:{id:e.viewlistData.eventId,label:"label1$"+t.id,page:"1"}}}},[e._v("再次编辑")]):e._e(),e._v(" "),"sendFail"==t.sendStatus?s("a",{directives:[{name:"ui",rawName:"v-ui",value:".pop"+a+e.viewlistData.isDraft,expression:"'.pop'+index+''+viewlistData.isDraft"}],staticClass:"mr-md popup",attrs:{href:"javascript:void(0)"}},[e._v("查看原因")]):e._e(),e._v(" "),"sendFail"==t.sendStatus&&t.describe?s("div",{class:"ui tip-code-info popup left  transition hidden pop"+a+e.viewlistData.isDraft},[e._v("\n                         "+e._s(t.describe)+"\n                    ")]):e._e(),e._v(" "),"toBeSent"==t.sendStatus?s("a",{class:"mr-md del-mail"+a+e.viewlistData.isDraft,attrs:{href:"javascript:void(0)"},on:{click:function(s){e.deleteSend(t.id,!0)}}},[e._v("删除")]):e._e(),e._v(" "),"toBeSent"==t.sendStatus?s("div",{directives:[{name:"ui",rawName:"v-ui",value:".del-mail"+a+e.viewlistData.isDraft,expression:"'.del-mail'+index+''+viewlistData.isDraft"}],staticClass:"ui small basic test modal confirm-layer"},[e._m(0,!0),e._v(" "),e._m(1,!0)]):e._e()],1)])}),e._v(" "),e._l(e.viewlist,function(t,a){return e.viewlistData.isDraft?s("tr",[s("td",[s("a",{staticClass:"mail-details isDraft",attrs:{href:"javascript:void(0)"},on:{click:function(t){e.active=a}}},[e._v(e._s(t.title))])]),e._v(" "),s("td",[e._v(e._s(t.receiverTotal))]),e._v(" "),s("td",[e._v(e._s(t.ctime))]),e._v(" "),s("td",[s("router-link",{staticClass:"mr-md",attrs:{to:{name:e.viewlistData.category,params:{id:e.viewlistData.eventId,label:"label1$"+t.id,page:"1"}}}},[e._v("编辑")]),e._v(" "),"toBeSent"==t.sendStatus?s("a",{class:"mr-md del-mail"+a+e.viewlistData.isDraft,attrs:{href:"javascript:void(0)"},on:{click:function(s){e.deleteSend(t.id)}}},[e._v("删除")]):e._e(),e._v(" "),"toBeSent"==t.sendStatus?s("div",{directives:[{name:"ui",rawName:"v-ui",value:".del-mail"+a+e.viewlistData.isDraft,expression:"'.del-mail'+index+''+viewlistData.isDraft"}],staticClass:"ui small basic test modal confirm-layer"},[e._m(2,!0),e._v(" "),e._m(3,!0)]):e._e()],1)]):e._e()})],2)]):e._e(),e._v(" "),0==e.viewlist.length?s("div",[s("img",{staticClass:"ui image medium centered",attrs:{src:"/images/no_centent.png",alt:e.categoryName+"列表为空"}})]):e._e(),e._v(" "),s("page",{ref:"page",on:{gotoPage:e.gotoPage}}),e._v(" "),e.viewlist[e.active]?s("div",{staticClass:"ui small modal mail-details-layer",class:e.viewlistData.isDraft?"isDraft":"notDraft"},[s("i",{staticClass:"close icon"}),e._v(" "),s("div",{staticClass:"header"},[e._v("\n            "+e._s(e.viewlist[e.active].title)+"\n        ")]),e._v(" "),s("div",{staticClass:"content",domProps:{innerHTML:e._s(e.viewlist[e.active].content)}})]):e._e()],1)},staticRenderFns:[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ui icon header"},[s("i",{staticClass:"idea icon"}),e._v(" 您确定要删除吗？ ")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"actions"},[s("div",{staticClass:"ui green ok inverted button"},[s("i",{staticClass:"checkmark icon"}),e._v(" 确定 ")]),e._v(" "),s("div",{staticClass:"ui red basic cancel inverted button"},[s("i",{staticClass:"remove icon"}),e._v(" 取消 ")])])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ui icon header"},[s("i",{staticClass:"idea icon"}),e._v(" 您确定要删除吗？ ")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"actions"},[s("div",{staticClass:"ui green ok inverted button"},[s("i",{staticClass:"checkmark icon"}),e._v(" 确定 ")]),e._v(" "),s("div",{staticClass:"ui red basic cancel inverted button"},[s("i",{staticClass:"remove icon"}),e._v(" 取消 ")])])}]}},325:function(e,t,s){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=s(28),n=a(i),r=s(2),l=s(208),d=a(l),o=s(209),c=a(o),v=s(4);t.default={name:"smsPage",data:function(){var e;return{balanceSMS:null,id:this.$route.params.id,page:this.$route.params.page,label:"",sendedId:this.$route.params.label.split("$").length>1?this.$route.params.label.split("$")[1]:"",sendDetails:(e={wordLength:66,category:"sms",dynamicdata:{noticement:["姓名","邮箱","签到码","电子票"],promotion:["活动链接"]},fromName:"",from:"",eventId:this.$route.params.id,userId:localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")).id:"",type:"promotion",title:"",receivers:""},(0,n.default)(e,"receivers",this.$route.params.label.split("~").length>1?this.$route.params.label.split("~")[1]:""),(0,n.default)(e,"content",""),(0,n.default)(e,"sendTime",null),(0,n.default)(e,"sendType","imediately"),(0,n.default)(e,"isDraft",!1),e),sendedData:{eventId:this.$route.params.id,category:"sms",isDraft:!1,page:this.$route.params.page,limit:10},draftData:{eventId:this.$route.params.id,category:"sms",isDraft:!0,page:this.$route.params.page,limit:10}}},created:function(){this.edit(),this.setBalance()},mounted:function(){this.label=this.getlabel()},components:{"send-details":d.default,"view-list":c.default},methods:{getlabel:function(){var e=void 0;switch(!0){case this.$route.params.label.split("$").length>1:e=this.$route.params.label.split("$")[0];break;case this.$route.params.label.split("!").length>1:e=this.$route.params.label.split("!")[0];break;case this.$route.params.label.split("~").length>1:e=this.$route.params.label.split("~")[0],this.sendDetails.isFromOrder=!0;break;default:e=this.$route.params.label}return e},setBalance:function(){var e=this;$.ajax({url:r.API_URL+"/wallet/getWalletDetail",data:{eventId:this.$route.params.id},success:function(t){e.balanceSMS=t.balanceSMS}})},setPage:function(){var e=this;this.id=this.$route.params.id,this.page=this.sendedData.page=this.draftData.page=this.$route.params.page,this.label=this.getlabel(),this.sendedId=this.$route.params.label.split("$").length>1?this.$route.params.label.split("$")[1]:"";var t="label2"==this.label?this.sendedData:this.draftData;this.$refs[this.label]?this.$refs[this.label].setData(t):"",""!==this.sendedId?this.edit():"label1"==this.label?this.$nextTick(function(){e.$refs.senddetails.clean()}):""},oneApi:function(){var e=this,t={eventId:this.id,recordType:"sms"};$.ajax({type:"get",async:!1,url:r.API_URL+"/event/getTypeCount",data:t,dataType:"json",contentType:"application/json",success:function(t){e.sendDetails.findType=t},error:function(e){}})},edit:function(){var e=this;""!=this.sendedId&&$.ajax({type:"get",url:r.API_URL+"/notice/getRecord",async:!1,data:{recordId:this.sendedId},dataType:"json",contentType:"application/json",success:function(t){e.sendDetails=$.extend(!0,{},e.sendDetails,(0,v.formatTime)(t,"YYYY-MM-DD HH:mm:ss"))},error:function(e){}}),this.oneApi(),this.$refs.senddetails?this.$refs.senddetails.setData(this.sendDetails):""}},watch:{$route:"setPage"}}},439:function(e,t,s){t=e.exports=s(21)(),t.push([e.id,".block-tab .ui.labelstyle[data-v-62daa4f2]{background:#fff;padding:30px}","",{version:3,sources:["/./src/views/maneger/sms.vue"],names:[],mappings:"AACA,2CACI,gBAAiB,AACjB,YAAc,CACjB",file:"sms.vue",sourcesContent:["\n.block-tab .ui.labelstyle[data-v-62daa4f2] {\n    background: #fff;\n    padding: 30px;\n}\n"],sourceRoot:"webpack://"}])},490:function(e,t,s){var a=s(439);"string"==typeof a&&(a=[[e.id,a,""]]);s(22)(a,{});a.locals&&(e.exports=a.locals)},631:function(e,t,s){var a,i;s(490),a=s(325);var n=s(716);i=a=a||{},"object"!=typeof a.default&&"function"!=typeof a.default||(i=a=a.default),"function"==typeof i&&(i=i.options),i.render=n.render,i.staticRenderFns=n.staticRenderFns,i._scopeId="data-v-62daa4f2",e.exports=a},716:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"manage-main"},[s("div",{staticClass:"ui container"},[s("div",{staticClass:"sub-title text-justify"},[s("h2",{staticClass:"fwn"},[e._v("短信")]),e._v(" "),s("div",{staticClass:"text-muted"},[e._v("您的短信余额："),s("span",{staticClass:"f24 text-default"},[e._v(e._s(e.balanceSMS?e.balanceSMS:"0"))]),e._v("条\n                "),s("router-link",{staticClass:"ui button red ml-md",attrs:{to:{path:"/recharge",query:{type:"sms"}}}},[e._v("充值")])],1)]),e._v(" "),s("div",{staticClass:"block-tab"},[s("div",{staticClass:"ui three item secondary menu f16"},[s("router-link",{staticClass:"item",class:{active:"label1"==e.label},attrs:{to:{name:"sms",params:{id:e.id,label:"label1",page:"1"}},"data-tab":"first"}},[s("span",[s("i",{staticClass:"edit icon"}),e._v("编辑短信")])]),e._v(" "),s("router-link",{staticClass:"item",class:{active:"label2"==e.label},attrs:{to:{name:"sms",params:{id:e.id,label:"label2",page:"1"}},"data-tab":"second"}},[s("span",[s("i",{staticClass:"send outline icon"}),e._v("已发送")])]),e._v(" "),s("router-link",{staticClass:"item",class:{active:"label3"==e.label},attrs:{to:{name:"sms",params:{id:e.id,label:"label3",page:"1"}},"data-tab":"third"}},[s("span",[s("i",{staticClass:"disk outline icon"}),e._v("草稿箱")])])],1),e._v(" "),"label1"==e.label?s("div",{staticClass:"ui labelstyle"},[s("send-details",{ref:"senddetails",attrs:{sendDetails:e.sendDetails},on:{success:e.setBalance}})],1):e._e(),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:"label2"==e.label,expression:"label=='label2'"}],staticClass:"ui labelstyle"},[s("view-list",{ref:"label2",attrs:{propsData:e.sendedData},on:{success:e.setBalance}})],1),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:"label3"==e.label,expression:"label=='label3'"}],staticClass:"ui labelstyle"},[s("view-list",{ref:"label3",attrs:{propsData:e.draftData}})],1)])]),e._v(" "),e._m(0)])},staticRenderFns:[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ui small basic test modal confirm-layer"},[s("div",{staticClass:"ui icon header"},[s("i",{staticClass:"idea icon"}),e._v(" 您确定要删除吗？ ")]),e._v(" "),s("div",{staticClass:"actions"},[s("div",{staticClass:"ui green ok inverted button"},[s("i",{staticClass:"checkmark icon"}),e._v(" 确定 ")]),e._v(" "),s("div",{staticClass:"ui red basic cancel inverted button"},[s("i",{staticClass:"remove icon"}),e._v(" 取消 ")])])])}]}}});
//# sourceMappingURL=3.2e322bd1989f292214cc.js.map